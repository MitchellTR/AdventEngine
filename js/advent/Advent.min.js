
var Advent={};Advent.gameFontFamily="Vollkorn";Advent.gameBackgroundColor="#ede4cd";Advent.gameTextColor="#5f4e2f";Advent.gameTextLinkColor="#6e82b0";Advent.fontSize=18;Advent.jQueryGameTextDiv="#gameTextDiv";Advent.jQueryPlayerInput="#playerInput";Advent.mapBGColor="#000000";Advent.mapLabelSize=22;Advent.mapLabelPos=20;Advent.mapLabelBGHeight=30;Advent.mapLocationGapSize=7;Advent.mapLocationColorString='#dbcda8';Advent.mapLocationSize=50;Advent.mapPlayerSize=20;Advent.mapUnseenFillColor='#3f2e0f';Advent.mapQuestionMarkSize=35;Advent.menuBackgroundBarColor='#dbcda8';Advent.messageQueue=[];Advent.padding=8;Advent.questTextColor="#cf520f";Advent.storyText="";Advent.textAlign="justify";Advent.userInputColor="red";Advent.userInputFamily="Muli";Advent.playerInventory=[];Advent.currentMap=null;Advent.quests=[];Advent.Document=function(){Advent.Prop.call(this);this.text=null;}
Advent.Game=function(){$("body").prepend("<div id=\"gameDiv\"></div>");$("#gameDiv").css({"height":"100%","width":"100%","overflow":"hidden","background-color":Advent.menuBackgroundBarColor});$("#gameDiv").append("<div id=\"gameButtonDiv\"></div>");$("#gameDiv").append("<div id=\"gameTextDiv\"></div>");$("#gameButtonDiv").css({"width":"99%","margin":"5px"});$("#gameButtonDiv").append("<div role=\"group\"><button onClick=\"Advent.showInventory()\" type=\"button\" class=\"btn btn-default gameButton\">Inventory</button> <button onClick=\"Advent.showQuests()\" type=\"button\" class=\"gameButton btn btn-default\">Quests</button> <button onClick=\"Advent.showMap()\" type=\"button\" class=\"gameButton btn btn-default\">Map</button></div>");Advent.setGameButtonStyle;var screenHeight=window.innerHeight;var buttonHeight=$("#gameButtonDiv").height();$("#gameTextDiv").css({"height":screenHeight-buttonHeight-10,"overflow-y":"auto","overflow-x":"hidden","text-align":Advent.textAlign,"padding-left":Advent.padding+"px","padding-right":Advent.padding+"px","font-family":Advent.gameFontFamily,"font-size":Advent.fontSize,"color":Advent.gameTextColor,backgroundColor:Advent.gameBackgroundColor});$("#gameTextDiv a").css({color:'#aaaaaa'});$("#gameDiv").append("<div id=\"entityModal\" class=\"modal fade\"><div id=\"entityDialog\" class=\"modal-dialog\"><div id=\"entityContent\" class=\"modal-content\"><div id=\"entityHeader\" class=\"gameModalHeader modal-header\"><button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button><h4 id=\"entityTitle\" class=\"modal-title\"></h4></div><div id=\"entityBody\" class=\"gameModalBody modal-body\"></div><div class=\"gameModalHeader modal-footer\"><button type=\"button\" class=\"gameButton btn btn-default\" data-dismiss=\"modal\">Close</button></div></div></div></div>");$(".gameModalHeader").css({backgroundColor:Advent.menuBackgroundBarColor,color:Advent.gameTextColor});$(".gameModalBody").css({backgroundColor:Advent.gameBackgroundColor,color:Advent.gameTextColor});Advent.setGameButtonStyle();console.log("♦ Advent Engine 0.0.0 initialized ♦");};Advent.GameEntity=function(){this.name=null;this.description=null;this.status=null;};Advent.setGameButtonStyle=function(){$(".gameButton").css({backgroundColor:Advent.gameBackgroundColor,color:Advent.gameTextColor,border:'1px solid '.concat(Advent.gameTextColor)});};Advent.Location=function(){Advent.GameEntity.call(this);this.seen=false;this.props=[];this.northLocation=null;this.northGate=null;this.southLocation=null;this.southGate=null;this.eastLocation=null;this.eastGate=null;this.westLocation=null;this.westGate=null;this.getDescription=function(showTitle){this.seen=true;if(showTitle){Advent.queueText("<span style=\"font-weight:bold; font-size:"+(Advent.fontSize+5)+"px;\">"+this.name.capitalize()+"</span>");}
Advent.queueText(this.description.capitalizeFirstLetter());Advent.describeSurroundingLocations(this);}}
Advent.Map=function(){Advent.GameEntity.call(this);this.locations=[];this.playerLocation=null;}
Advent.Goal=function(){Advent.GameEntity.call(this);this.complete=false;}
Advent.Prop=function(){Advent.GameEntity.call(this);this.canTake=false;}
Advent.Quest=function(){Advent.Goal.call(this);this.tasks=[];this.handleInput=null;this.introduceQuest=function(){Advent.queueText("<span style=\"color:".concat(Advent.questTextColor,";\"><b>New quest added:</b></span>"));Advent.queueText("<span style=\"color:".concat(Advent.questTextColor,";\">(",this.name.capitalize(),") ",this.description.capitalizeFirstLetter(),"</span>"));this.questUpdate();}
this.questUpdate=function(){Advent.queueText("<span style=\"color:".concat(Advent.questTextColor,";\"><b>Quest Updated:</b> </span>"));var nextTask=null;var i=0;while(!nextTask){if(!this.tasks[i].complete){nextTask=this.tasks[i];}
i++;}
Advent.queueText("<span style=\"color:".concat(Advent.questTextColor,";\">(",this.name.capitalize(),") ",nextTask.description,"</span>"));}
this.completeQuest=function(){this.complete=true;Advent.queueText("<span style=\"color:".concat(Advent.questTextColor,";\"><b>Quest Completed:</b> </span>"));Advent.queueText("<span style=\"color:".concat(Advent.questTextColor,";\">",this.name.capitalize(),"</span>"));}}
Advent.Task=function(){Advent.Goal.call(this);this.parentQuest=null;this.completeTask=function(lastTask){this.complete=true;Advent.queueText("<span style=\"color:".concat(Advent.questTextColor,";\"><b>Task Completed:</b> </span>"));Advent.queueText("<span style=\"color:".concat(Advent.questTextColor,";\">(",this.parentQuest.name.capitalize(),") ",this.name.capitalize(),"</span>"));if(lastTask){this.parentQuest.completeQuest();}else{this.parentQuest.questUpdate();}}
this.isCurrentTask=function(){var firstIncomplete="";for(var i=0;i<this.parentQuest.tasks.length;i++){if(!this.parentQuest.tasks[i].complete){if(firstIncomplete==""){firstIncomplete=this.parentQuest.tasks[i].name;}}}
return this.name==firstIncomplete;}}
Advent.attemptLocationChange=function(locationName){var currentLocation=Advent.currentMap.playerLocation;if(currentLocation.northLocation){if(Advent.currentMap.playerLocation.northLocation.name==locationName){if(!currentLocation.northGate){Advent.currentMap.playerLocation=currentLocation.northLocation;currentLocation=currentLocation.northLocation;if(currentLocation.seen){Advent.queueText("You return to <a onClick=\"Advent.getCurrentLocationDescription()\">"+currentLocation.name+"</a>.");Advent.describeSurroundingLocations(currentLocation);}else{currentLocation.getDescription(true);}}else{Advent.queueText(currentLocation.northGate.capitalizeFirstLetter());}}}
if(currentLocation.southLocation){if(Advent.currentMap.playerLocation.southLocation.name==locationName){if(!currentLocation.southGate){Advent.currentMap.playerLocation=currentLocation.southLocation;currentLocation=currentLocation.southLocation;if(currentLocation.seen){Advent.queueText("You return to <a onClick=\"Advent.getCurrentLocationDescription()\">"+currentLocation.name+"</a>.");Advent.describeSurroundingLocations(currentLocation);}else{currentLocation.getDescription(true);}}else{Advent.queueText(currentLocation.southGate.capitalizeFirstLetter());}}}
if(currentLocation.eastLocation){if(Advent.currentMap.playerLocation.eastLocation.name==locationName){if(!currentLocation.eastGate){Advent.currentMap.playerLocation=currentLocation.eastLocation;currentLocation=currentLocation.eastLocation;if(currentLocation.seen){Advent.queueText("You return to <a onClick=\"Advent.getCurrentLocationDescription()\">"+currentLocation.name+"</a>.");Advent.describeSurroundingLocations(currentLocation);}else{currentLocation.getDescription(true);}}else{Advent.queueText(currentLocation.eastGate.capitalizeFirstLetter());}}}
if(currentLocation.westLocation){if(Advent.currentMap.playerLocation.westLocation.name==locationName){if(!currentLocation.westGate){Advent.currentMap.playerLocation=currentLocation.westLocation;currentLocation=currentLocation.westLocation;if(currentLocation.seen){Advent.queueText("You return to <a onClick=\"Advent.getCurrentLocationDescription()\">"+currentLocation.name+"</a>.");Advent.describeSurroundingLocations(currentLocation);}else{currentLocation.getDescription(true);}}else{Advent.queueText(currentLocation.westGate.capitalizeFirstLetter());}}}
Advent.broadcastAction("location ".concat(locationName.toLowerCase()));}
Advent.broadcastAction=function(message){for(var i=0;i<Advent.quests.length;i++){Advent.quests[i].handleInput(message);}}
Advent.describeSurroundingLocations=function(location){if(location.northLocation){Advent.queueText(" ".concat(Advent.getLocationMarkup(location.northLocation,location.northLocation.name.capitalizeFirstLetter())," is to the north."),true);}
if(location.southLocation){Advent.queueText(" ".concat(Advent.getLocationMarkup(location.southLocation,location.southLocation.name.capitalizeFirstLetter())," is to the south."),true);}
if(location.eastLocation){Advent.queueText(" ".concat(Advent.getLocationMarkup(location.eastLocation,location.eastLocation.name.capitalizeFirstLetter())," is to the east."),true);}
if(location.westLocation){Advent.queueText(" ".concat(Advent.getLocationMarkup(location.westLocation,location.westLocation.name.capitalizeFirstLetter())," is to the west."),true);}}
Advent.getCurrentLocationDescription=function(){Advent.currentMap.playerLocation.getDescription();}
Advent.getDocumentMarkup=function(document,tag){return"<a onClick=\"Advent.showDocumentMenu('".concat(document.name.quoteSafe(),"','",document.text.quoteSafe(),"',",document.canTake,")\">",tag.quoteSafe(),"</a>");}
Advent.getLocationMarkup=function(location,tag){return"<a onClick=\"Advent.attemptLocationChange('".concat(location.name.quoteSafe(),"')\">",tag.quoteSafe(),"</a>");}
Advent.getPropMarkup=function(prop,tag){return"<a onClick=\"Advent.showPropMenu('".concat(prop.name.quoteSafe(),"','",prop.description.quoteSafe(),"',",prop.canTake,")\">",tag.quoteSafe(),"</a>");}
Advent.postTextImmediately=function(message){$(Advent.jQueryGameTextDiv).html(Advent.storyText+message);Advent.storyText+=message;Advent.scrollToBottom();};Advent.queueText=function(message,noBreak){var breakString="<br/>";if(noBreak){breakString="";}
Advent.messageQueue.push(breakString.concat(message));if(Advent.messageQueue.length==1){setTimeout(Advent.updateStory,1000);}};Advent.scrollToBottom=function(){$(Advent.jQueryGameTextDiv).animate({scrollTop:$(Advent.jQueryGameTextDiv)[0].scrollHeight},500);};Advent.showDocumentMenu=function(name,text,canTake){$("#entityTitle").html(name.capitalize().quoteSafe());$("#entityBody").html("<span style=\"text-align:justify\"><i>".concat(text,"</i>"));if(canTake){$("#entityBody").append("<div style=\"width:100%;text-align:center;\"><button id=\"takeDocumentButton\" onClick=\"Advent.takeItem('".concat(name.quoteSafe(),"')\" type=\"button\" class=\"gameButton btn btn-default\">Take</button></div>"));Advent.setGameButtonStyle();}
$("#entityBody").append("</span>");$("#entityModal").modal('show');Advent.broadcastAction("read ".concat(name.toLowerCase()));};Advent.showPropMenu=function(name,description,canTake){$("#entityTitle").html(name.capitalize().quoteSafe());$("#entityBody").html("<span class=\"modal-body\" style=\"text-align:justify\"><p>".concat(description.capitalizeFirstLetter(),"</p>"));if(canTake){$("#entityBody").append("<div style=\"width:100%;text-align:center;\"><button id=\"#takeButton\" onClick=\"Advent.takeItem('".concat(name.quoteSafe(),"')\" type=\"button\" class=\"gameButton btn btn-default\">Take</button></div>"));Advent.setGameButtonStyle();}
$("#entityBody").append("</span>");$("#entityModal").modal('show');Advent.broadcastAction("look ".concat(name.toLowerCase()));};Advent.showInventory=function(){var inventoryString="";if(Advent.playerInventory.length==0){inventoryString="There are no items in your inventory.";}else{for(var i=0;i<Advent.playerInventory.length;i++){inventoryString=inventoryString.concat("<li class=\"gameListGroupItem list-group-item\"><span class=\"list-group-item-heading\"><strong>",Advent.playerInventory[i].name.capitalize(),"</strong><span><p class=\"list-group-item-class\">",Advent.playerInventory[i].description.capitalizeFirstLetter(),"</p></li>");}}
$("#entityTitle").html("Inventory");$("#entityBody").html("<ul class=\"list-group\">".concat(inventoryString,"</ul>"));$(".gameListGroupItem").css({backgroundColor:Advent.menuBackgroundBarColor,color:Advent.gameTextColor,border:'1px solid '.concat(Advent.gameTextColor)});$("#entityModal").modal('show');};Advent.showMap=function(){$("#entityTitle").html(Advent.currentMap.name.capitalize());$("#entityBody").html("<div id=\"#canvasDiv\" style=\"background-color:".concat(Advent.menuBackgroundBarColor,";width:100%;border:1px solid ",Advent.gameTextColor,";text-align:center;\"><canvas id=\"map\"></canvas></div>"));var canvas=new fabric.Canvas('map');canvas.setWidth(350);canvas.setHeight(300);canvas.setBackgroundColor(Advent.gameTextColor,canvas.renderAll.bind(canvas));$(".canvas-container").css({"margin":"0 auto"});var roomLabelBG=new fabric.Rect({left:0,top:Advent.mapLabelPos,fill:Advent.gameTextColor,opacity:0.5,width:canvas.getWidth(),height:Advent.mapLabelBGHeight});roomLabelBG.selectable=false;canvas.add(roomLabelBG);var roomLabel=new fabric.Text(Advent.currentMap.playerLocation.name.capitalize(),{fontSize:Advent.mapLabelSize,left:canvas.getCenter().left,top:Advent.mapLabelPos,fontFamily:Advent.gameFontFamily,fill:Advent.menuBackgroundBarColor,fontWeight:'bold',originX:'center'});roomLabel.selectable=false;canvas.add(roomLabel);Advent.renderLocations({firstLocation:Advent.currentMap.playerLocation,canvas:canvas,roomLabel:roomLabel,roomLabelBG:roomLabelBG});$("#entityModal").modal('show');}
Advent.renderLocations=function(data){var updateTitle=function(shape){data.roomLabel.text=data.firstLocation.name.capitalize();}
var drawX,drawY;if(data.x){drawX=data.x;}else{drawX=data.canvas.getCenter().left-Advent.mapLocationSize/2;}
if(data.y){drawY=data.y;}else{drawY=data.canvas.getCenter().top-Advent.mapLocationSize/2;}
var rect=new fabric.Rect({left:drawX,top:drawY,fill:Advent.mapLocationColorString,width:Advent.mapLocationSize,height:Advent.mapLocationSize,strokeWidth:1,stroke:Advent.mapLocationColorString});rect.hasControls=false;rect.padding=1;rect.borderColor=Advent.mapLocationColorString;rect.on('selected',function(){updateTitle(rect);});rect.previousX=rect.left;rect.previousY=rect.top;rect.index=data.canvas._objects.length-2;rect.on('moving',function(){Advent.dragOtherShapes(data.canvas,rect);});data.canvas.add(rect);if(data.firstLocation.name==Advent.currentMap.playerLocation.name){var triangle=new fabric.Triangle({width:Advent.mapPlayerSize,height:Advent.mapPlayerSize,fill:Advent.gameTextLinkColor,left:data.canvas.getCenter().left-Advent.mapPlayerSize/2,top:data.canvas.getCenter().top-Advent.mapPlayerSize/2});triangle.hasControls=triangle.hasBorders=false;triangle.on('selected',function(){updateTitle(rect);data.canvas.setActiveObject(rect);});triangle.previousX=triangle.left;triangle.previousY=triangle.top;triangle.index=data.canvas._objects.length-2;triangle.on('moving',function(){Advent.dragOtherShapes(data.canvas,triangle);});data.canvas.add(triangle);}
if(!data.firstLocation.seen){rect.set('fill',Advent.mapUnseenFillColor);var questionMark=new fabric.Text('?',{fontSize:Advent.mapQuestionMarkSize,left:rect.getCenterPoint().x,top:rect.getCenterPoint().y-Advent.mapQuestionMarkSize/2,fontFamily:Advent.gameFontFamily,fill:Advent.mapLocationColorString,fontWeight:'bold',originX:'center'});questionMark.hasBorders=questionMark.hasControls=false;questionMark.on('selected',function(){updateTitle(rect);data.canvas.setActiveObject(rect);});questionMark.previousX=questionMark.left;questionMark.previousY=questionMark.top;questionMark.index=data.canvas._objects.length-2;questionMark.on('moving',function(){Advent.dragOtherShapes(data.canvas,questionMark);});data.canvas.add(questionMark);}
if(data.firstLocation.seen){if(data.cameFromDirection!="north"){if(data.firstLocation.northLocation){var fillString;if(data.firstLocation.northGate){fillString=Advent.questTextColor;}else{fillString=Advent.mapLocationColorString;}
var northEntrywayRect=new fabric.Rect({left:drawX+Advent.mapLocationSize/4,top:drawY-Advent.mapLocationGapSize,fill:fillString,width:Advent.mapLocationSize/2,height:Advent.mapLocationGapSize});northEntrywayRect.hasBorders=northEntrywayRect.hasControls=false;northEntrywayRect.previousX=northEntrywayRect.left;northEntrywayRect.previousY=northEntrywayRect.top;northEntrywayRect.index=data.canvas._objects.length-2;northEntrywayRect.on('moving',function(){Advent.dragOtherShapes(data.canvas,northEntrywayRect);});data.canvas.add(northEntrywayRect);Advent.renderLocations({firstLocation:data.firstLocation.northLocation,canvas:data.canvas,cameFromDirection:"south",x:drawX,y:drawY-Advent.mapLocationGapSize-Advent.mapLocationSize,roomLabel:data.roomLabel,roomLabelBG:data.roomLabelBG});}}
if(data.cameFromDirection!="south"){if(data.firstLocation.southLocation){var fillString;if(data.firstLocation.southGate){fillString='red';}else{fillString=Advent.mapLocationColorString;}
var southEntrywayRect=new fabric.Rect({left:drawX+Advent.mapLocationSize/4,top:drawY+Advent.mapLocationSize,fill:fillString,width:Advent.mapLocationSize/2,height:Advent.mapLocationGapSize});southEntrywayRect.hasBorders=southEntrywayRect.hasControls=false;southEntrywayRect.previousX=southEntrywayRect.left;southEntrywayRect.previousY=southEntrywayRect.top;southEntrywayRect.index=data.canvas._objects.length-2;southEntrywayRect.on('moving',function(){Advent.dragOtherShapes(data.canvas,southEntrywayRect);});data.canvas.add(southEntrywayRect);Advent.renderLocations({firstLocation:data.firstLocation.southLocation,canvas:data.canvas,cameFromDirection:"north",x:drawX,y:drawY+Advent.mapLocationSize+Advent.mapLocationGapSize,roomLabel:data.roomLabel,roomLabelBG:data.roomLabelBG});}}
if(data.cameFromDirection!="east"){if(data.firstLocation.eastLocation){var fillString;if(data.firstLocation.eastGate){fillString='red';}else{fillString=Advent.mapLocationColorString;}
var eastEntrywayRect=new fabric.Rect({left:drawX+Advent.mapLocationSize,top:drawY+Advent.mapLocationSize/4,fill:fillString,width:Advent.mapLocationGapSize,height:Advent.mapLocationSize/2});eastEntrywayRect.hasBorders=eastEntrywayRect.hasControls=false;eastEntrywayRect.previousX=eastEntrywayRect.left;eastEntrywayRect.previousY=eastEntrywayRect.top;eastEntrywayRect.index=data.canvas._objects.length-2;eastEntrywayRect.on('moving',function(){Advent.dragOtherShapes(data.canvas,eastEntrywayRect);});data.canvas.add(eastEntrywayRect);Advent.renderLocations({firstLocation:data.firstLocation.eastLocation,canvas:data.canvas,cameFromDirection:"west",x:drawX+Advent.mapLocationSize+Advent.mapLocationGapSize,y:drawY,roomLabel:data.roomLabel,roomLabelBG:data.roomLabelBG});}}
if(data.cameFromDirection!="west"){if(data.firstLocation.westLocation){var fillString;if(data.firstLocation.westGate){fillString='red';}else{fillString=Advent.mapLocationColorString;}
var westEntrywayRect=new fabric.Rect({left:drawX-Advent.mapLocationGapSize,top:drawY+Advent.mapLocationSize/4,fill:fillString,width:Advent.mapLocationGapSize,height:Advent.mapLocationSize/2});westEntrywayRect.hasBorders=westEntrywayRect.hasControls=false;westEntrywayRect.previousX=westEntrywayRect.left;westEntrywayRect.previousY=westEntrywayRect.top;westEntrywayRect.index=data.canvas._objects.length-2;westEntrywayRect.on('moving',function(){Advent.dragOtherShapes(data.canvas,westEntrywayRect);});data.canvas.add(westEntrywayRect);Advent.renderLocations({firstLocation:data.firstLocation.westLocation,canvas:data.canvas,cameFromDirection:"east",x:drawX-Advent.mapLocationGapSize-Advent.mapLocationSize,y:drawY,roomLabel:data.roomLabel,roomLabelBG:data.roomLabelBG});}}}
data.roomLabelBG.bringToFront();data.roomLabel.bringToFront();console.log(data.canvas._objects);}
Advent.dragOtherShapes=function(canvas,shape){for(var i=0;i<canvas._objects.length-2;i++){if(i!=shape.index){canvas._objects[i].left=canvas._objects[i].left-(shape.previousX-shape.left);canvas._objects[i].top=canvas._objects[i].top-(shape.previousY-shape.top);canvas._objects[i].previousX=canvas._objects[i].left;canvas._objects[i].previousY=canvas._objects[i].top;canvas._objects[i].setCoords();}}
shape.previousX=shape.left;shape.previousY=shape.top;};Advent.showQuests=function(){$("#entityTitle").html("Quests");var currentMarkup="";var completeMarkup="";for(var i=0;i<Advent.quests.length;i++){var bodyMarkup="<div class=\"gameQuestHeader accordion\"><h3><strong>".concat(Advent.quests[i].name,"</strong></h3><div style=\"padding:7px;\"><i>",Advent.quests[i].description,"</i>");var completedTaskMarkup="";var currentTaskMarkup="";for(var j=0;j<Advent.quests[i].tasks.length;j++){if(Advent.quests[i].tasks[j].complete){completedTaskMarkup=completedTaskMarkup.concat("<div class=\"subAccordion\"><h3>",Advent.quests[i].tasks[j].name,"</h3><div>",Advent.quests[i].tasks[j].description,"</div></div>");}else if(Advent.quests[i].tasks[j].complete==false){if(j==0){currentTaskMarkup=currentTaskMarkup.concat("<div class=\"subAccordion\"><h3>",Advent.quests[i].tasks[j].name,"</h3><div>",Advent.quests[i].tasks[j].description,"</div></div>");}else if(Advent.quests[i].tasks[j-1].complete){currentTaskMarkup=currentTaskMarkup.concat("<div class=\"subAccordion\"><h3>",Advent.quests[i].tasks[j].name,"</h3><div>",Advent.quests[i].tasks[j].description,"</div></div>");}}}
var currentLabel="";if(currentTaskMarkup!=""){currentLabel="</br><strong>Current Task</strong>";}
var completedLabel="";if(completedTaskMarkup!=""){completedLabel="</br><strong>Completed Tasks</strong>";}
bodyMarkup=bodyMarkup.concat(currentLabel.concat(currentTaskMarkup,completedLabel,completedTaskMarkup,"</div></div>"));bodyMarkup=bodyMarkup.concat();if(!Advent.quests[i].complete){currentMarkup=currentMarkup.concat(bodyMarkup);}else{completeMarkup=completeMarkup.concat(bodyMarkup);}}
var currentQuestLabel="";var completedQuestsLabel="";if(currentMarkup!=""){currentQuestLabel="<h4>Current Quests</h4>";}
if(completeMarkup!=""){completedQuestsLabel="<h4>Completed Quests</h4>";}
$("#entityBody").html(currentQuestLabel.concat(currentMarkup,completedQuestsLabel,completeMarkup));$(".accordion").accordion({heightStyle:"content",collapsible:true,active:false});$(".subAccordion").accordion({heightStyle:"content",collapsible:true,active:false});$(".ui-accordion-header").css({backgroundColor:Advent.menuBackgroundBarColor,color:Advent.gameTextColor,border:'1px solid '.concat(Advent.gameTextColor)});$(".ui-accordion-content").css({backgroundColor:Advent.gameBackgroundColor,color:Advent.gameTextColor,border:'1px solid '.concat(Advent.gameTextColor)});$("#entityModal").modal('show');}
Advent.takeItem=function(itemName){for(var i=0;i<Advent.currentMap.playerLocation.props.length;i++){if(itemName==Advent.currentMap.playerLocation.props[i].name){Advent.playerInventory.push(Advent.currentMap.playerLocation.props[i]);Advent.currentMap.playerLocation.props.splice(i,1);}}
$("#entityModal").modal('hide');Advent.queueText("".concat(itemName.capitalizeFirstLetter()," has been added to your inventory."));Advent.broadcastAction("take ".concat(itemName.toLowerCase()));}
Advent.updateStory=function(){if(Advent.messageQueue.length>0){if(!($("#entityModal").data('bs.modal')||{}).isShown){var newMessage=Advent.messageQueue.splice(0,1);var propPattern=/<prop name='[\w\s]+'>[\w\s]+<\/prop>/;if(propPattern.test(newMessage)){Advent.queueText(String(newMessage).match(propPattern));}
$(Advent.jQueryGameTextDiv).html(Advent.storyText+"<span id='fadeText' style='display:none;'>"+newMessage+"</span>");$("#fadeText").fadeIn(950);Advent.storyText+=newMessage;Advent.scrollToBottom();if(Advent.messageQueue.length>0){setTimeout(Advent.updateStory,1000);}}else{setTimeout(Advent.updateStory,1000);}}
$("a").css({color:Advent.gameTextLinkColor});};String.prototype.capitalize=function(){return this.toLowerCase().replace(/(^|\s+)\b\w/g,function(m){return m.toUpperCase();});};String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1);}
String.prototype.quoteSafe=function(){return this.replace(/'/g,"\\\'");}